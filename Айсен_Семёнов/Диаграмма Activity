```mermaid
activityDiagram
    title Процесс работы с AI-Индексатором артефактов

    start

    if (Какое действие выполняет аналитик?) then (Присвоить метки)
        partition "Интерфейс Пользователя" {
            :Аналитик выбирает один или несколько артефактов;
            :Нажимает кнопку "Присвоить метки";

            if (Выбрано >= N артефактов?) then (Да, массовое присвоение)
                :Запустить фоновую задачу;
                :Показать уведомление о запуске фоновой задачи;
                stop
            else (Нет, стандартное присвоение)
            endif
        }

        partition "Система / AI-Индексатор" {
            :Система отправляет запрос к AI-Индексатору;

            alt Сбой или низкая уверенность AI
                :AI-сервис недоступен (сбой, таймаут);
                partition "Интерфейс Пользователя" {
                    :Отобразить ошибку "Сервис недоступен";
                    :Предложить ввести метки вручную;
                }
                -->[Аналитик вводит метки] Взаимодействие с UI

            else Успешный ответ от AI
                 :AI возвращает список рекомендованных меток с confidence;
                  partition "Интерфейс Пользователя" {
                    if (Уверенность модели < порога?) then (Да)
                        :Показать предупреждение о низкой уверенности;
                    else (Нет)
                        :Отобразить рекомендации AI;
                    endif
                }
                --> Взаимодействие с UI
            end
        }

        partition "Интерфейс Пользователя" {
            activity "Взаимодействие с UI"
            :Аналитик принимает/отклоняет рекомендации;
            :Аналитик добавляет собственные метки;

            if (Попытка добавить больше меток, чем разрешено лимитом?) then (Да)
                :Показать предупреждение о превышении лимита;
                :Ожидать удаления старых меток;
            else (Нет)
            endif
            :Аналитик нажимает "Сохранить";
        }

        partition "Система / БД" {
            fork
                :Сохранить принятые метки в БД;
            fork again
                :Отправить данные (метки, фидбэк) в очередь дообучения модели;
            end fork
            :Обновить интерфейс с новыми метками;
        }
        --> stop

    else (Фильтровать по меткам)
        partition "Интерфейс Пользователя" {
            :Аналитик выбирает команду "Фильтровать";
            :Выбирает до 5 меток для фильтрации;
            :Применяет фильтр;
        }

        partition "Система / БД" {
            :Система выполняет запрос к хранилищу артефактов;
        }

        partition "Интерфейс Пользователя" {
            if (Результат фильтрации пустой?) then (Да)
                :Показать сообщение "Ничего не найдено";
                :Предложить изменить критерии фильтрации;
            else (Нет)
                :Отобразить список артефактов, соответствующих фильтру;
            endif
        }
        --> stop
    endif
```
