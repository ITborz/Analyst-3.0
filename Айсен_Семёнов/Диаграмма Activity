```mermaid
activityDiagram
    title Процесс работы с AI-Индексатором артефактов

    start

    if (Действие аналитика: присвоить метки?) then (Да)
        partition UI {
            :Выбрать один или несколько артефактов;
            :Нажать «Присвоить метки»;
            if (Выбрано ≥ N артефактов?) then (Да)
                :Запустить фоновую задачу;
                :Показать уведомление о старте фоновой задачи;
                stop
            else (Нет)
            endif
        }

        partition AI {
            :Отправить запрос в AI-Индексатор;
            alt Сбой или низкая уверенность
                :AI-сервис недоступен или таймаут;
                partition UI_fallback {
                    :Показать ошибку «Сервис недоступен»;
                    :Предложить ввод меток вручную;
                }
                -->|Аналитик вводит метки| UI_decision
            else Успех
                :AI возвращает список меток с confidence;
                if (confidence < порог?) then (Да)
                    :Показать предупреждение о низкой уверенности;
                else (Нет)
                    :Отобразить рекомендации AI;
                endif
                --> UI_decision
            end
        }

        partition UI_decision {
            activity «Взаимодействие с UI»
            :Принять/отклонить рекомендации;
            :Добавить собственные метки;
            if (Превышен лимит меток?) then (Да)
                :Показать предупреждение о лимите;
                :Дождаться удаления лишних меток;
            else (Нет)
            endif
            :Нажать «Сохранить»;
        }

        partition DB {
            fork
                :Сохранить принятые метки в БД;
            fork again
                :Отправить метки и фидбэк в очередь дообучения модели;
            end fork
            :Обновить интерфейс с новыми метками;
        }
        --> stop

    else (Нет: фильтровать по меткам)
        partition UI_filter {
            :Нажать «Фильтровать»;
            :Выбрать до 5 меток;
            :Применить фильтр;
        }

        partition DB_filter {
            :Выполнить запрос к хранилищу артефактов;
        }

        partition UI_results {
            if (Результат пуст?) then (Да)
                :Показать «Ничего не найдено»;
                :Предложить изменить фильтр;
            else (Нет)
                :Отобразить отфильтрованный список;
            endif
        }
        --> stop
    endif
```
